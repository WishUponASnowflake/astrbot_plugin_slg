# infra/map_provider.py
from typing import Dict
from ..domain.entities import MapGraph, City

class StaticMapProvider:
    def load(self) -> MapGraph:
        # 城市/关隘/资源镇定义（九州）
        cities: Dict[str, City] = {
            # 冀州
            "邺": City("邺", "冀", "CITY", capital=True),
            "南皮": City("南皮", "冀", "CITY"),
            # 兖州
            "鄄城": City("鄄城", "兖", "CITY", capital=True),
            "东阿": City("东阿", "兖", "CITY"),
            # 青州
            "临淄": City("临淄", "青", "CITY", capital=True),
            "北海": City("北海", "青", "CITY"),
            # 徐州
            "彭城": City("彭城", "徐", "CITY", capital=True),
            "下邳": City("下邳", "徐", "CITY"),
            # 扬州
            "建业": City("建业", "扬", "CITY", capital=True),
            "会稽": City("会稽", "扬", "CITY"),"淮口关": City("淮口关", "扬", "PASS"),
            # 荆州
            "江陵": City("江陵", "荆", "CITY", capital=True),
            "襄阳": City("襄阳", "荆", "CITY"),
            # 豫州（含司隶范围做简化）
            "洛阳": City("洛阳", "豫", "CITY", capital=True),
            "许昌": City("许昌", "豫", "CITY"),
            "陈留": City("陈留", "豫", "CITY"),
            "汝南": City("汝南", "豫", "RESOURCE"),
            # 雍州
            "长安": City("长安", "雍", "CITY", capital=True),"陈仓道": City("陈仓道", "雍", "PASS"),
            "潼关": City("潼关", "雍", "PASS"),"北地郡": City("北地郡", "雍", "CITY"),
            # 益州
            "成都": City("成都", "益", "CITY", capital=True),
            "汉中": City("汉中", "益", "CITY"),
            "江州": City("江州", "益", "CITY"),
        }

        # 固定战线：每城最多三门（北/东/西）
        lines = {
            # 冀州
            "邺": {"北门": "南皮", "东门": "东阿"},
            "南皮": {"南门": "邺","南门": "陈仓道"},

            # 兖州
            "鄄城": {"西门": "东阿", "北门": "邺", "东门": "临淄"},
            "东阿": {"西门": "鄄城", "东门": "邺", "北门": "临淄"},

            # 青州
            "临淄": {"西门": "东阿", "北门": "北海"},
            "北海": {"南门": "临淄"},

            # 徐州
            "彭城": {"西门": "陈留", "东门": "下邳", "南门": "淮口关"},
            "下邳": {"西门": "彭城", "南门": "淮口关"},

            # 扬州
            "建业": {"北门": "淮口关", "东门": "会稽"},
            "淮口关": {"南门": "建业", "北门": "彭城", "东门": "下邳"},
            "会稽": {"西门": "建业", "西北门": "江陵"},

            # 荆州
            "江陵": {"北门": "襄阳", "西门": "江州", "东门": "会稽"},
            "襄阳": {"东门": "许昌", "西门": "江陵"},

            # 豫州
            "洛阳": {"南门": "许昌", "西门": "潼关"},
            "许昌": {"北门": "洛阳", "东门": "陈留", "南门": "汝南"},
            "陈留": {"西门": "许昌", "东门": "彭城", "南门": "汝南"},
            "汝南": {"北门": "许昌", "北东门": "陈留"},

            # 雍州
            "长安": {"东门": "潼关","南门": "北地郡"},"北地郡": {"东门": "长安"},
            "潼关": {"东门": "洛阳", "西门": "长安", "南门": "汉中"},
            "陈仓道": {"北门": "南皮","南门": "长安"},
            # 益州
            "成都": {"北门": "汉中", "东门": "江州"},
            "汉中": {"南门": "成都", "北门": "潼关"},
            "江州": {"西门": "成都", "东门": "江陵"},
        }




        # 统一把非“北/东/西”门名也当战线允许（渲染时只展示，不做方向约束）
        normalized = {}
        for city, gates in lines.items():
            normalized[city] = dict(gates)
        return MapGraph(cities=cities, lines=normalized)
